<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Manager</title>
    <style>
        /* ...existing styles... */

        .image-section {
            margin: 15px 0;
        }

        .image-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .image-preview {
            max-width: 300px;
            margin: 10px 0;
        }

        .preview-container {
            position: relative;
            display: inline-block;
        }

        .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            padding: 5px;
            cursor: pointer;
        }

        .recipe-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .recipe-header {
            background: #f8f9fa;
            padding: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .recipe-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            padding: 0 15px;
        }

        .recipe-card.expanded .recipe-content {
            max-height: 2000px;
            padding: 15px;
            transition: max-height 0.5s ease-in;
        }

        .recipe-header .toggle-icon {
            font-family: monospace;
            transition: transform 0.3s ease;
        }

        .recipe-card.expanded .toggle-icon {
            transform: rotate(90deg);
        }

        .recipe-thumbnail {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 4px;
            margin-right: 10px;
        }

        .recipe-container h2,
        .recipe-container h3 {
            color: #000000;  /* Solid black */
            font-size: 20px;
            font-weight: 600;
            margin: 15px 0;
            padding: 8px 0;
            border-bottom: 2px solid #000000; /* Black border */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .recipe-container h2 {
            font-size: 24px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="recipe-container">
        <h2>Add New Recipe</h2>
        <div class="recipe-form">
            <input type="text" id="recipeName" class="recipe-input" placeholder="Recipe Name">
            
            <!-- Image section -->
            <div class="image-section">
                <h3>Recipe Image</h3>
                <div class="image-buttons">
                    <button onclick="document.getElementById('imageUpload').click()" class="elementor-button">
                        Upload Image
                    </button>
                    <button onclick="openCamera()" class="elementor-button">
                        Take Photo
                    </button>
                </div>
                <input type="file" id="imageUpload" accept="image/*" style="display: none" onchange="handleImage(this.files)">
                <video id="camera" style="display: none; max-width: 100%; margin-top: 10px;"></video>
                <button id="captureBtn" style="display: none" class="elementor-button">Capture Photo</button>
                <div id="imagePreview" style="margin-top: 10px;"></div>
            </div>

            <textarea id="recipeDescription" class="recipe-input" rows="3" placeholder="Recipe Description"></textarea>
            
            <h3>Ingredients</h3>
            <div class="ingredient-section">
                <div class="ingredient-inputs">
                    <input type="text" id="ingredientName" class="recipe-input" placeholder="Ingredient">
                    <input type="text" id="ingredientAmount" class="recipe-input" placeholder="Amount">
                    <button onclick="addIngredient()" class="elementor-button">Add Ingredient</button>
                </div>
                <ul id="ingredientList" class="ingredient-list"></ul>
            </div>

            <h3>Preparation Steps</h3>
            <div class="steps-section">
                <textarea id="recipeSteps" class="recipe-input" rows="5" placeholder="Enter preparation steps..."></textarea>
            </div>

            <button onclick="saveRecipe()" class="elementor-button">Save Recipe</button>
        </div>

        <!-- Add this button after the "My Recipes" heading -->
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h2>My Recipes</h2>
            <button onclick="clearAllRecipes()" class="elementor-button">Clear All Recipes</button>
        </div>

        <div id="recipeList"></div>
    </div>

    <script>
        let ingredients = [];
        let recipeImage = null;

        function addIngredient() {
            const name = document.getElementById('ingredientName').value;
            const amount = document.getElementById('ingredientAmount').value;
            
            if (name && amount) {
                ingredients.push({ name, amount });
                updateIngredientList();
                clearIngredientInputs();
            }
        }

        function updateIngredientList() {
            const list = document.getElementById('ingredientList');
            list.innerHTML = '';
            
            ingredients.forEach((ingredient, index) => {
                const li = document.createElement('li');
                li.className = 'ingredient-item';
                li.innerHTML = `
                    <span>${ingredient.amount} ${ingredient.name}</span>
                    <span class="remove-btn" onclick="removeIngredient(${index})">✖</span>
                `;
                list.appendChild(li);
            });
        }

        function removeIngredient(index) {
            ingredients.splice(index, 1);
            updateIngredientList();
        }

        function clearIngredientInputs() {
            document.getElementById('ingredientName').value = '';
            document.getElementById('ingredientAmount').value = '';
        }

        function handleImage(files) {
            if (files && files[0]) {
                const file = files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    // Create an image to get dimensions
                    const img = new Image();
                    img.onload = function() {
                        // Target max dimensions
                        const maxWidth = 800;
                        const maxHeight = 600;
                        
                        // Calculate new dimensions
                        let width = img.width;
                        let height = img.height;
                        
                        if (width > maxWidth) {
                            height = (height * maxWidth) / width;
                            width = maxWidth;
                        }
                        if (height > maxHeight) {
                            width = (width * maxHeight) / height;
                            height = maxHeight;
                        }
                        
                        // Create canvas for resizing
                        const canvas = document.createElement('canvas');
                        canvas.width = width;
                        canvas.height = height;
                        
                        // Draw and compress image
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        // Convert to compressed JPEG
                        recipeImage = canvas.toDataURL('image/jpeg', 0.7);
                        showImagePreview(recipeImage);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function openCamera() {
            const camera = document.getElementById('camera');
            const captureBtn = document.getElementById('captureBtn');
            
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    camera.srcObject = stream;
                    camera.style.display = 'block';
                    captureBtn.style.display = 'block';
                    camera.play();
                    
                    captureBtn.onclick = function() {
                        const canvas = document.createElement('canvas');
                        canvas.width = camera.videoWidth;
                        canvas.height = camera.videoHeight;
                        canvas.getContext('2d').drawImage(camera, 0, 0);
                        recipeImage = canvas.toDataURL('image/jpeg');
                        showImagePreview(recipeImage);
                        
                        // Stop camera
                        stream.getTracks().forEach(track => track.stop());
                        camera.style.display = 'none';
                        captureBtn.style.display = 'none';
                    };
                })
                .catch(err => {
                    console.error('Camera error:', err);
                    alert('Could not access camera');
                });
        }

        function showImagePreview(imageData) {
            const preview = document.getElementById('imagePreview');
            preview.innerHTML = `
                <div class="preview-container">
                    <img src="${imageData}" class="image-preview">
                    <span class="remove-image" onclick="removeImage()">✖</span>
                </div>
            `;
        }

        function removeImage() {
            recipeImage = null;
            document.getElementById('imagePreview').innerHTML = '';
            document.getElementById('imageUpload').value = '';
        }

        function saveRecipe() {
            const recipe = {
                name: document.getElementById('recipeName').value,
                description: document.getElementById('recipeDescription').value,
                ingredients: [...ingredients],
                steps: document.getElementById('recipeSteps').value,
                image: recipeImage,
                timestamp: new Date().toISOString()
            };

            let recipes = JSON.parse(localStorage.getItem('recipes') || '[]');
            recipes.push(recipe);
            localStorage.setItem('recipes', JSON.stringify(recipes));

            displayRecipes();
            clearForm();
        }

        function clearForm() {
            document.getElementById('recipeName').value = '';
            document.getElementById('recipeDescription').value = '';
            document.getElementById('recipeSteps').value = '';
            ingredients = [];
            recipeImage = null;
            updateIngredientList();
            document.getElementById('imagePreview').innerHTML = '';
            document.getElementById('imageUpload').value = '';
        }

        function displayRecipes() {
            const recipes = JSON.parse(localStorage.getItem('recipes') || '[]');
            const recipeList = document.getElementById('recipeList');
            recipeList.innerHTML = '';

            recipes.forEach((recipe, index) => {
                const card = document.createElement('div');
                card.className = 'recipe-card';
                card.innerHTML = `
                    <div class="recipe-header" onclick="toggleRecipe(this.parentElement)">
                        <div style="display: flex; align-items: center;">
                            ${recipe.image ? 
                                `<img src="${recipe.image}" class="recipe-thumbnail" alt="${recipe.name}">` : 
                                '<div class="recipe-thumbnail" style="background: #eee;"></div>'}
                            <h3 style="margin: 0;">${recipe.name}</h3>
                        </div>
                        <span class="toggle-icon">▶</span>
                    </div>
                    <div class="recipe-content">
                        ${recipe.image ? 
                            `<img src="${recipe.image}" style="max-width: 100%; margin-bottom: 15px;">` : ''}
                        <p><strong>Description:</strong></p>
                        <p>${recipe.description}</p>
                        <p><strong>Ingredients:</strong></p>
                        <ul>
                            ${recipe.ingredients.map(ing => 
                                `<li>${ing.amount} ${ing.name}</li>`).join('')}
                        </ul>
                        <p><strong>Steps:</strong></p>
                        <p>${recipe.steps}</p>
                        <div style="margin-top: 15px; display: flex; gap: 10px;">
                            <button onclick="editRecipe(${index})" class="elementor-button">Edit Recipe</button>
                            <button onclick="deleteRecipe(${index})" class="elementor-button">Delete Recipe</button>
                        </div>
                    </div>
                `;
                recipeList.appendChild(card);
            });
        }

        function toggleRecipe(element) {
            element.classList.toggle('expanded');
        }

        function deleteRecipe(index) {
            if (confirm('Are you sure you want to delete this recipe?')) {
                let recipes = JSON.parse(localStorage.getItem('recipes') || '[]');
                recipes.splice(index, 1);
                localStorage.setItem('recipes', JSON.stringify(recipes));
                displayRecipes();
            }
        }

        function clearAllRecipes() {
            if (confirm('Are you sure you want to delete ALL recipes? This cannot be undone.')) {
                localStorage.removeItem('recipes');
                displayRecipes();
            }
        }

        function editRecipe(index) {
            const recipes = JSON.parse(localStorage.getItem('recipes') || '[]');
            const recipe = recipes[index];
            
            // Populate form with recipe data
            document.getElementById('recipeName').value = recipe.name;
            document.getElementById('recipeDescription').value = recipe.description;
            document.getElementById('recipeSteps').value = recipe.steps;
            
            // Handle image
            recipeImage = recipe.image;
            if (recipe.image) {
                showImagePreview(recipe.image);
            }
            
            // Handle ingredients
            ingredients = [...recipe.ingredients];
            updateIngredientList();
            
            // Scroll to form
            document.querySelector('.recipe-form').scrollIntoView({ behavior: 'smooth' });
            
            // Modify save button
            const saveButton = document.querySelector('.recipe-form button:last-child');
            saveButton.textContent = 'Update Recipe';
            // Store the index as a data attribute
            saveButton.setAttribute('data-edit-index', index);
            saveButton.onclick = function() {
                const editIndex = parseInt(this.getAttribute('data-edit-index'));
                updateRecipe(editIndex);
                return false;
            };
        }

        function updateRecipe(index) {
            const recipes = JSON.parse(localStorage.getItem('recipes') || '[]');
            
            const updatedRecipe = {
                name: document.getElementById('recipeName').value,
                description: document.getElementById('recipeDescription').value,
                ingredients: [...ingredients],
                steps: document.getElementById('recipeSteps').value,
                image: recipeImage,
                timestamp: new Date().toISOString()
            };
            
            recipes[index] = updatedRecipe;
            localStorage.setItem('recipes', JSON.stringify(recipes));
            
            // Reset form and button
            const saveButton = document.querySelector('.recipe-form button:last-child');
            saveButton.textContent = 'Save Recipe';
            saveButton.removeAttribute('data-edit-index');
            saveButton.onclick = saveRecipe;
            
            clearForm();
            displayRecipes();
        }

        // Initialize the display
        document.addEventListener('DOMContentLoaded', displayRecipes);
    </script>
</body>
</html>